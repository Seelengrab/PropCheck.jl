<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Generating Containers · PropCheck.jl Documentation</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">PropCheck.jl Documentation</a></span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Main Page</a></li><li><a class="tocitem" href="../intro.html">Introduction to PBT</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="basic.html">Basic Usage</a></li><li><a class="tocitem" href="structs.html">Generating Structs</a></li><li class="is-active"><a class="tocitem" href="containers.html">Generating Containers</a><ul class="internal"><li><a class="tocitem" href="#Generating-tuples"><span>Generating tuples</span></a></li><li><a class="tocitem" href="#Generating-vectors"><span>Generating vectors</span></a></li></ul></li><li><a class="tocitem" href="properties.html">Composing Generators</a></li></ul></li><li><a class="tocitem" href="../shrinktrees.html">Shrinking with <code>Tree</code>s</a></li><li><a class="tocitem" href="../interfaces.html">Interfaces</a></li><li><a class="tocitem" href="../api.html">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="containers.html">Generating Containers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="containers.html">Generating Containers</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Seelengrab/PropCheck.jl/blob/main/docs/src/Examples/containers.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Generating-Containers"><a class="docs-heading-anchor" href="#Generating-Containers">Generating Containers</a><a id="Generating-Containers-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-Containers" title="Permalink"></a></h1><p>So far we&#39;ve only looked at generating objects from their types or simple structs, but this can become difficult when we&#39;re trying to generate more complicated objects like tuples or arrays with a generated size. After all, there is not a unique vector with a fixed length that has the type <code>Vector{Int}</code>, for example - all vectors containing <code>Int</code>, regardless of their length, have the same type. A similar thing is true for tuples if we don&#39;t know their length ahead of time and we want to generate that length as well.</p><h2 id="Generating-tuples"><a class="docs-heading-anchor" href="#Generating-tuples">Generating tuples</a><a id="Generating-tuples-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-tuples" title="Permalink"></a></h2><p>We&#39;re going to start by generating homogenous tuples of things. PropCheck.jl provides a convenience function for this: <a href="../api.html#PropCheck.tuple-Union{Tuple{T}, Tuple{PropCheck.AbstractIntegrated, PropCheck.AbstractIntegrated{T}}} where T"><code>PropCheck.tuple(n, gen)</code></a>.</p><p>Consider this property:</p><pre><code class="language-julia hljs">using PropCheck

prop(x) = all(&lt;(5), x)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">prop (generic function with 1 method)</code></pre><p>This property tests whether all elements of the argument are smaller than <code>5</code>.</p><p>In order to test that all tuples we can conceivably think of obey this property (or produce a counterexample!), we use <code>tuple</code>. Its first argument is a generator for a number to use as the length, and the second argument a generator for the objects contained within the tuple. The simplest generator for a length is a generator that just returns its given argument, called <a href="../api.html#PropCheck.iconst-Tuple{Any}"><code>iconst</code></a>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; const_sized_tuple = PropCheck.tuple(iconst(3), itype(Int8));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; tree = generate(const_sized_tuple)</code><code class="nohighlight hljs ansi" style="display:block;">Tree((-73, 54, -104))</code></pre><p>And indeed, the generated size of the tuple is <code>3</code>. Checking the values this tree shrinks to, we can see that they too are of size <code>3</code>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; all(t -&gt; length(root(t)) == 3, subtrees(tree))</code><code class="nohighlight hljs ansi" style="display:block;">true</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; using Random: shuffle!</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shuffle!(collect(subtrees(tree)))[1:5]</code><code class="nohighlight hljs ansi" style="display:block;">5-element Vector{PropCheck.Tree{Tuple{Int8, Int8, Int8}}}:
 Tree((-73, -38, -104))
 Tree((-71, 54, -104))
 Tree((-65, 54, -104))
 Tree((-73, -48, -104))
 Tree((-73, 54, 102))</code></pre><p>I&#39;m only showing a subset of all generated subtrees because the full list is quite long. Nevertheless, if we put our generator into <code>check</code> to test our property:</p><pre><code class="language-julia hljs">check(prop, const_sized_tuple)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(0, 0, 5)</code></pre><p>PropCheck.jl successfully reduces the first failing test case to one where no elements can be shrunk further without making the test pass, giving us our smallest possible counterexample - a tuple with all zeros, except for one place which has <code>5</code> instead. There are three of these minimal cases for <code>prop</code>: <code>(5,0,0)</code>, <code>(0,5,0)</code> and <code>(0,0,5)</code>. In general, there may be much more than these three minimal cases, and yet again more cases that are not minimal at all.</p><h3 id="Variable-size-tuples"><a class="docs-heading-anchor" href="#Variable-size-tuples">Variable size tuples</a><a id="Variable-size-tuples-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-size-tuples" title="Permalink"></a></h3><p>You may notice that the tuple is always of size 3, never smaller - the reasoning for this behavior is twofold:</p><ol><li>Tuples generally don&#39;t change their size - they are immutable containers, and as such manipulating them will create a new tuple altogether.</li><li>Tuples are created during generation when you require a constant number of things, but want to still shrink the things themselves.</li></ol><p>But what if we truly do want to generate tuples of various sizes, for example because we want to test some recursive reduction over them?</p><p>This too is simple - we only have to change the generator passed into <code>tuple</code> to one that can produce multiple distinct values, like <a href="../api.html#PropCheck.isample"><code>isample</code></a>:</p><pre><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; variable_size_tuple = PropCheck.tuple(isample(0:10), itype(Int8));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; [ generate(variable_size_tuple) for _ in 1:5 ]</code><code class="nohighlight hljs ansi" style="display:block;">5-element Vector{PropCheck.Tree}:
 Tree((-110,))
 Tree((86, -110, 116, 21, 4, -93, 113, -67, 115, 29))
 Tree((-49, 21, 55, -86))
 Tree((60, 87, 14, 50))
 Tree((-116, 34, -92, -80))</code></pre><h2 id="Generating-vectors"><a class="docs-heading-anchor" href="#Generating-vectors">Generating vectors</a><a id="Generating-vectors-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-vectors" title="Permalink"></a></h2><p>Similar to tuples, there is also <code>PropCheck.vector(n, gen)</code> to get a generator which generates <code>Vector</code>s of <code>n</code> elements:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using PropCheck</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; vec = PropCheck.vector(iconst(3), itype(Int8));</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Which we can then run against the <code>prop</code> from earlier:</p><pre><code class="language-julia-repl hljs">julia&gt; prop(x) = all(&lt;(5), x)
prop (generic function with 1 method)

julia&gt; check(prop, vec)
┌ Info: Found counterexample for &#39;prop&#39;, beginning shrinking...
│   Counterexample =
│    3-element Vector{Int8}:
│     -62
│      57
└      81
[ Info: 7 counterexamples found
3-element Vector{Int8}:
 0
 0
 5</code></pre><p>though for a <code>Vector</code>, a constant size of <code>3</code> is of course not minimal. We can do better here, by allowing the vector to shrink its length. There are multiple options for achieving this:</p><ul><li><a href="../api.html#PropCheck.isample"><code>isample</code></a>, which samples from a collection <code>v</code></li><li><a href="../api.html#PropCheck.ival-Union{Tuple{T}, Tuple{T, Any}} where T"><code>ival</code></a>, which always produces the same value (like <code>iconst</code>), but allows it to shrink</li></ul><p>The former is mostly useful when we don&#39;t care about the exact element we generate, but would like it to be from some defined collection of values, while the latter is useful when we want to start out with some value, but are fine with shrinks of that value as well. <code>isample</code> has the additional ability to limit values generated from a range to stay limited to that range.</p><p>For example, if we use <code>ival(3)</code> for the length of our vector:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; valvec = PropCheck.vector(ival(3), itype(Int8));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; [ generate(valvec) for _ in 1:5 ]</code><code class="nohighlight hljs ansi" style="display:block;">5-element Vector{PropCheck.Tree{Vector{Int8}}}:
 Tree(Int8[-50, 108, -103])
 Tree(Int8[-70, 89, -3])
 Tree(Int8[-28, 104, 84])
 Tree(Int8[-12, 83, 112])
 Tree(Int8[-32, 119, -26])</code></pre><p>We can see that they all start out as vectors of length <code>3</code>, but their subtrees can be smaller too:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; subs = collect(subtrees(generate(valvec)));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; filter(v -&gt; length(root(v)) &lt; 3, subs)</code><code class="nohighlight hljs ansi" style="display:block;">3-element Vector{PropCheck.Tree{Vector{Int8}}}:
 Tree(Int8[30, -109])
 Tree(Int8[-95, -109])
 Tree(Int8[-95, 30])</code></pre><p>If we use <code>isample</code> instead of <code>ival</code>, we can see that, just as with tuples, the initial value has a size depending on what we sampled from:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; samplevec = PropCheck.vector(isample(0:5), itype(Int8));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; [ generate(samplevec) for _ in 1:5 ]</code><code class="nohighlight hljs ansi" style="display:block;">5-element Vector{PropCheck.Tree{Vector{Int8}}}:
 Tree(Int8[91, 93, 38, 125, -99])
 Tree(Int8[93, 52, 120])
 Tree(Int8[-115, 53, -15, 10, -21])
 Tree(Int8[])
 Tree(Int8[])</code></pre><p>and subsequently, the minimal counterexample also changes, to the vector containing nothing but <code>5</code>:</p><pre><code class="language-julia-repl hljs">julia&gt; check(prop, valvec; show_initial=false)
[ Info: Found counterexample for &#39;prop&#39;, beginning shrinking...
[ Info: 7 counterexamples found
1-element Vector{Int8}:
 5

julia&gt; check(prop, samplevec; show_initial=false)
[ Info: Found counterexample for &#39;prop&#39;, beginning shrinking...
[ Info: 9 counterexamples found
1-element Vector{Int8}:
 5</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="structs.html">« Generating Structs</a><a class="docs-footer-nextpage" href="properties.html">Composing Generators »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 10 July 2023 15:24">Monday 10 July 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
